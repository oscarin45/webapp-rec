(function(){var $,base,buscar,cart,cat,formData,index,inicio,mainView,msg,myApp,post,prod,sube,titleCat;$=Dom7,cat=[],buscar=[],prod="",titleCat="",inicio=!0,base="http://recuadros.com/",myApp=new Framework7({swipePanel:"left",hideToolbarOnPageScroll:!0,hideNavbarOnPageScroll:!0,showBarsOnPageScrollEnd:!1}),$(document).on("ajaxStart",function(e){return myApp.showIndicator()}),$(document).on("ajaxComplete",function(){return myApp.hideIndicator()}),addToHomescreen(),mainView=myApp.addView(".view-main"),msg=function(e){return e=eval("("+e.detail.data+")"),e.error&&myApp.alert(e.error,"Error!"),e.msg&&myApp.alert(e.msg,"Mensaje"),e},post=function(e,t,n){return $.ajax({url:e,method:"POST",data:t,success:n,contentType:"multipart/form-data"})},index=function(){return $.getJSON(base+"test",function(e){var t,n,r,i,s;return i=Template7.compile($("#navTpl").html()),$("#navHtml").html(i(e)),$("#cartItem").text(e.items),t=Template7.compile($("#banTpl").html()),$(".swiper-1 .swiper-wrapper").html(t(e)),n=myApp.swiper(".swiper-1",{autoplay:4e3,speed:800,loop:!0}),inicio&&(cat.items=e.nov),s=Template7.compile($("#novTpl").html()),$("#novHtml").html(s(e)),r=myApp.swiper(".swiper-2",{slidesPerView:2,nextButton:".slider-next-button",prevButton:".slider-prev-button"}),buscar.items.length&&inicio===!1?cat=buscar:cat.items=e.nov})},index(),myApp.onPageInit("index",function(e){return inicio=!0,index()}),myApp.onPageInit("contacto",function(e){return $.get(base+"post/captcha/1/1",function(e){return $("#captcha").val(e)}),$("form.ajax-submit").on("submitted",function(e){return msg(e)})}),$.get("login.html",function(e){return $(".login-screen").html(e),$("form#aut-log").on("submitted",function(e){var t;t=msg(e);if(t.msg)return myApp.closeModal(".login-screen"),mainView.loadPage("index.html"),setTimeout(function(){return mainView.loadPage("cart.html")},500)})}),$.get("registro.html",function(e){return $(".popup-registro").html(e),$("form#aut-reg").on("submitted",function(e){return msg(e)})}),myApp.onPageInit("categorias",function(e){return $.getJSON(base+"test/cats",function(e){var t;return t=Template7.compile($("#tplCat").html()),$("#novCat").html(t(e)),$(".itemcat").click(function(e){return titleCat=$(this).parent().find(".card-content").text()})})}),myApp.onPageInit("lista",function(e){var t,n,r,i,s;return r=e.url.replace("list.html?",""),n=Template7.compile($("#tplHead").html()),s=Template7.compile($("#tplLi").html()),i=1,t=!0,$.getJSON(base+"test/cat/"+r+"/"+i++,function(e){return e.title=titleCat,$("#list").html(n(e)),$("#list .row").append(s(e)),cat=e.items,$(".infinite-scroll").on("infinite",function(){if(t)return $.getJSON(base+"test/cat/"+r+"/"+i++,function(n){var r,i,o,u;$("#list .row").append(s(n)),u=n.items;for(i=0,o=u.length;i<o;i++)r=u[i],e.items.push(r);cat=e.items;if(n.items.length===0)return t=!1})})})}),myApp.onPageInit("producto",function(e){var t,n,r;return n=e.url.replace("prod.html?",""),r=Template7.compile($("#tplPr").html()),t=like(cat,"id",n),prod=t[0],titleCat!=null&&(prod.title=titleCat),$("#det").html(r(prod))}),myApp.onPageInit("producto-detalle",function(e){var t;return t=Template7.compile($("#tplPr2").html()),$("#detpr").html(t(prod)).find(".media-list").each(function(e){return $(this).find("input").eq(0).attr("checked",!0)})}),myApp.onPageInit("prod3",function(e){var t,n,r;return t=myApp.formToJSON("#detpr"),n="",$.each(t,function(e,t){return n+='<input type="hidden" name="'+e+'" value="'+t+'"/>'}),$("#tplFrm").append(n),r=Template7.compile($("#tplFrm").html()),$("#form").html(r(prod)),$.post(base+"home/total",myApp.formToJSON("#form"),function(e){return $("#form #total").html(e)}),$("form#form").on("submitted",function(e){return $("#cartItem").text(e.detail.data),mainView.loadPage("cart.html")})}),cart=function(){var cr;return cr=Template7.compile($("#tplCr").html()),$.getJSON(base+"test/cart",function(d){return $("#cart").html(cr(d)),$(".swipeout").on("deleted",function(){return $.get(base+"upc/"+$(this).find(".swipeout-delete").data("id"),function(){return $.get(base+"test/item",function(e){return $("#cartItem").text(e),mainView.router.reloadPage("cart.html"),myApp.alert("El producto ha sido removido","Mensaje")})})}),$("#actualizar").click(function(){var e;return $("#redirect_path").val(""),e=myApp.formToJSON("#cart"),$.post($("#cart").attr("action"),e,function(e){return mainView.router.reloadPage("cart.html"),$("#cartItem").text(e),myApp.alert("El producto fue actualizado","Mensaje")}),$("#redirect_path").val("")}),$("#enviar").click(function(){var frm;return $("#redirect_path").val("enviar"),frm=myApp.formToJSON("#cart"),$.post($("#cart").attr("action"),frm,function(e){e=eval("("+e+")"),e.paypal&&(window.top.location.href=e.paypal);if(e.msg)return myApp.alert(e.msg,"Mensaje"),mainView.loadPage("index.html")})})})},myApp.onPageInit("cart",function(e){return cart()}),setTimeout(function(){return $("#logout").click(function(){return $.getJSON(base+"auth/logout/1",function(e){return mainView.loadPage("index.html")})})},1500),$(document).on("pageAfterBack pageInit",function(e){var t;t=e.detail.page.view.url;switch(t){case"sear.html":return inicio=!1,cat=buscar;case"index.html":return inicio=!0,cat=[]}}),myApp.onPageInit("buscar",function(e){var pr;return pr=Template7.compile($("#tplBus").html()),$(".searchbar input[type=search]").on("keyup change",function(e){var vl;vl=$(this).val();if(vl.length>3)return $.post(base+"test/sear",{like:vl},function(s){return s=eval("("+s+")"),$(".list-block-search").html(pr(s)),cat.items=s.items,buscar=s})})}),sube="",myApp.onPageInit("sube2",function(e){var id,pr;return id=e.url.replace("sube2.html?",""),pr=Template7.compile($("#tplCd").html()),$.get(base+"test/sube/"+id,function(s){return s=eval("("+s+")"),$("#novCd").html(pr(s.find(".media-list").each(function(e){return $(this).find("input").eq(0).prop("checked",!0)})))})}),formData="",myApp.onPageInit("sube3",function(e){var t,n,r,i;return r=Template7.compile($("#tplsb").html()),formData=myApp.formToJSON("#novCd"),formData.name=$("#novCd .back .item-after").text(),i=Object.keys(formData)[1],t=new Object,n=$('#novCd input[value="'+formData[i]+'"]').parent().find(".medidas"),n.children("span").each(function(e){return t[e]={w:$(this).data("w"),h:$(this).data("h")}}),formData.id=n.data("id"),formData.carga=t,$("#sbCd").html(r(formData)),$("input[type=file]").change(function(e){var t,n,r;return t=$(this),n=new FormData,r=e.target.files,r.file=r[0],$.each(r,function(e,t){return n.append(e,t)}),$.ajax({url:base+"home/upload/"+formData.id+"/"+t.data("w")+"/"+t.data("h")+"/file/1",type:"POST",data:n,cache:!1,dataType:"json",processData:!1,contentType:!1,statusCode:{404:function(e){return myApp.alert("page not found")}},success:function(e,n,r){e.error&&myApp.alert(e.error,"Error");if(e.upload_data)return $("#upload").html("<img>"),myApp.popup(".popup-upload"),$("#upload img").prop("src",e.upload_data.thumb).addClass("br"),t.next().val(e.upload_data.thumb)}})}),$("#avanzar").click(function(e){var t,n;return t=myApp.formToJSON("#sbCd"),n=!0,$.each(t,function(e,t){if(!t)return n=!1}),n?mainView.loadPage($(this).data("ur")):myApp.alert("Falta alguna imagen por subir","Mensaje")})}),myApp.onPageInit("sube4",function(e){var t,n;return $("#name").text(formData.name),n=myApp.formToJSON("#sbCd"),formData.canvas=n[Object.keys(n)[0]],t=new Array,t[0]=formData.base+"img/"+formData.estilo+".jpg",t[1]=n[Object.keys(n)[0]],formData.img=t,$.post(base+"home/img_in/0/1",formData,function(e){return $("#total").html(e)}),$("form#form").on("submitted",function(e){return $("#cartItem").text(e.detail.data),mainView.loadPage("cart.html")})})}).call(this)